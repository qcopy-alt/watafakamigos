#!/bin/sh
# kudos to https://github.com/zhuowei/cheese-app/blob/c7a34c75af85d6bae712536b71a1ece0f2a6457d/app/src/main/assets/cheese/launch.sh
#echo "mod by @a62family (tg)"
#echo "launch.sh running"
#echo "got root, doing magic fixes..."
#cd "$(dirname "$0")"
#umask 000
#export FIRST_STAGE=1
#export ASH_STANDALONE=1
#PATH="/product/bin:/apex/com.android.runtime/bin:/apex/com.android.art/bin:/system_ext/bin:/system/bin:/system/xbin:/odm/bin:/vendor/bin:/vendor/xbin"
#export PATH
#echo "starting magisk setup... (may take a while, don't touch anything)"
#echo "if you see /debug_ramdisk errors, use manual for magisk install (write soon)"
#sh "$PWD/live_setup.sh"
#!/system/bin/sh

# === ПРОВЕРКА КОНТЕКСТА ===
CUR_CON=$(cat /proc/self/attr/current)
if [ "$CUR_CON" != "u:r:init:s0" ]; then
    echo "FATAL: run with wrapper!"
    echo "current: $CUR_CON, need: u:r:init:s0"
    exit 1
fi

echo "✓ contect correct: $CUR_CON"
echo "launch.sh running"

cd "$(dirname "$0")"
umask 000
export FIRST_STAGE=1
export ASH_STANDALONE=1

export MAGISKTMP="$(pwd)/magisk_work"
mkdir -p "$MAGISKTMP"

mount -t tmpfs -o mode=0755 tmpfs "$MAGISKTMP" 2>/dev/null
if [ $? -eq 0 ]; then
    echo "✓ tmpfs mounted в $MAGISKTMP"
else
    echo "⚠️  use just directory without tmpfs"
fi

echo "starting magisk setup..."
sh "$PWD/live_setup.sh"